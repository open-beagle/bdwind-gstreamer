<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>BDWind GStreamer Desktop Capture</title>
    <link rel="stylesheet" href="/style.css" />
  </head>
  <body>
    <div class="container">
      <div class="header">
        <h1>BDWind GStreamer</h1>
        <p>高性能桌面流媒体服务器</p>
      </div>

      <div class="main-content">
        <div class="video-section">
          <h3>桌面流媒体</h3>
          <div class="video-container" id="video-container">
            <video
              id="video"
              autoplay
              playsinline
              muted
              style="display: none"
              tabindex="0"
            >
              您的浏览器不支持视频播放
            </video>
            <audio id="audio" autoplay playsinline style="display: none">
              您的浏览器不支持音频播放
            </audio>
            <div id="video-placeholder" class="video-placeholder">
              点击"开始捕获"开始桌面共享
            </div>

            <!-- 视频控制覆盖层 -->
            <div
              class="video-controls-overlay"
              id="video-controls"
              style="display: none"
            >
              <button
                class="control-btn"
                onclick="toggleVideoPlay()"
                title="播放/暂停"
              >
                <span id="play-icon">⏸️</span>
              </button>
              <button
                class="control-btn"
                onclick="toggleFullscreen()"
                title="全屏"
              >
                <span id="fullscreen-icon">⛶</span>
              </button>
              <button
                class="control-btn"
                onclick="toggleAudioMute()"
                title="静音"
              >
                <span id="mute-icon">🔊</span>
              </button>
              <input
                type="range"
                id="volume-slider"
                min="0"
                max="1"
                step="0.1"
                value="1"
                onchange="setVolume(this.value)"
                title="音量"
              />
            </div>

            <!-- 视频信息覆盖层 -->
            <div
              class="video-info-overlay"
              id="video-info"
              style="display: none"
            >
              <div>分辨率: <span id="resolution-info">0x0</span></div>
              <div>帧率: <span id="fps-info">0</span> fps</div>
              <div>比特率: <span id="bitrate-info">0</span> kbps</div>
              <div>延迟: <span id="latency-info">0</span> ms</div>
            </div>
          </div>

          <div class="controls">
            <button class="btn btn-primary" onclick="playStream()">
              开始捕获
            </button>
            <button
            <button class="btn btn-secondary" onclick="toggleFullscreen()">
              全屏
            </button>
            <button class="btn btn-secondary" onclick="getDisplays()">
              显示器
            </button>
          </div>
        </div>

        <div class="sidebar">
          <div class="panel">
            <h3>连接状态</h3>
            <div id="connection-status">
              <span class="status-indicator status-offline"></span>
              <span id="status-text">离线</span>
            </div>
            <div class="stats-grid">
              <div class="stat-item">
                <div class="stat-value" id="fps-value">0</div>
                <div class="stat-label">FPS</div>
              </div>
              <div class="stat-item">
                <div class="stat-value" id="bitrate-value">0</div>
                <div class="stat-label">Kbps</div>
              </div>
              <div class="stat-item">
                <div class="stat-value" id="clients-value">0</div>
                <div class="stat-label">客户端</div>
              </div>
              <div class="stat-item">
                <div class="stat-value" id="latency-value">0</div>
                <div class="stat-label">延迟(ms)</div>
              </div>
            </div>
          </div>

          <div class="panel">
            <h3>系统监控</h3>

            <!-- 系统健康状态 -->
            <div id="system-health" class="system-health good">
              <div class="health-score">100</div>
              <div class="health-status">良好</div>
            </div>

            <div class="monitoring-tabs">
              <button
                class="tab-btn active"
                onclick="switchMonitoringTab('performance')"
              >
                性能
              </button>
              <button
                class="tab-btn"
                onclick="switchMonitoringTab('connections')"
              >
                连接
              </button>
            </div>

            <!-- 性能监控面板 -->
            <div id="performance-panel" class="monitoring-panel active">
              <div class="metrics-grid">
                <div class="metric-card">
                  <div class="metric-title">CPU使用率</div>
                  <div class="metric-value" id="cpu-usage">0%</div>
                  <div class="metric-chart" id="cpu-chart"></div>
                </div>
                <div class="metric-card">
                  <div class="metric-title">内存使用</div>
                  <div class="metric-value" id="memory-usage">0%</div>
                  <div class="metric-chart" id="memory-chart"></div>
                </div>
                <div class="metric-card">
                  <div class="metric-title">GPU使用率</div>
                  <div class="metric-value" id="gpu-usage">N/A</div>
                  <div class="metric-chart" id="gpu-chart"></div>
                </div>
                <div class="metric-card">
                  <div class="metric-title">网络流量</div>
                  <div class="metric-value" id="network-usage">0 KB/s</div>
                  <div class="metric-chart" id="network-chart"></div>
                </div>
              </div>
            </div>

            <!-- 连接状态面板 -->
            <div id="connections-panel" class="monitoring-panel">
              <div class="connection-summary">
                <div class="connection-stat">
                  <div class="stat-value" id="total-connections">0</div>
                  <div class="stat-label">总连接数</div>
                </div>
                <div class="connection-stat">
                  <div class="stat-value" id="active-connections">0</div>
                  <div class="stat-label">活跃连接</div>
                </div>
                <div class="connection-stat">
                  <div class="stat-value" id="avg-rtt">0</div>
                  <div class="stat-label">平均RTT(ms)</div>
                </div>
                <div class="connection-stat">
                  <div class="stat-value" id="total-bandwidth">0 B</div>
                  <div class="stat-label">总带宽</div>
                </div>
                <div class="connection-stat">
                  <div class="stat-value" id="packet-loss-rate">0.00%</div>
                  <div class="stat-label">丢包率</div>
                </div>
                <div class="connection-stat">
                  <div
                    class="stat-value connection-quality"
                    id="connection-quality"
                  >
                    优秀
                  </div>
                  <div class="stat-label">连接质量</div>
                </div>
              </div>

              <!-- 连接历史图表 -->
              <div class="metrics-grid" style="margin-bottom: 15px">
                <div class="metric-card">
                  <div class="metric-title">连接数历史</div>
                  <div class="metric-chart" id="connections-chart"></div>
                </div>
                <div class="metric-card">
                  <div class="metric-title">RTT历史</div>
                  <div class="metric-chart" id="rtt-chart"></div>
                </div>
              </div>

              <div class="connection-list" id="connection-list">
                <div class="connection-header">
                  <span>客户端ID</span>
                  <span>状态</span>
                  <span>RTT</span>
                  <span>丢包率</span>
                  <span>操作</span>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <script src="/libs/webrtc-adapter-9.0.1.min.js"></script>
    <script src="/enhanced-logger.js"></script>
    <script src="/config.js"></script>
    <script src="/utils.js"></script>
    <script src="/event-bus.js"></script>
    <script src="/input.js"></script>
    <script src="/monitoring.js"></script>
    <script src="/signaling.js"></script>
    <script src="/webrtc.js"></script>
    <script src="/error-handler.js"></script>
    <script src="/ui.js"></script>
    <script src="/app.js"></script>
  </body>
</html>